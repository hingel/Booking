name: Publish Docker image

on: 
    push:
        #branches: [main]
    pull_request:
        branches: [ development ]
        paths:
        - '**.cs'
        - '**.csproj'

jobs:
    push_to_registry:
        name: Push Docker image to Docker Hub
        runs-on: ubuntu-latest
        permissions:
            packages: write
            contents: read
            attestations: write
            id-token: write
        steps:
            - name: Check out repo
              uses: actions/checkout@v3
            
            - name: Log in to Docker Hub
              uses: docker/login-action@v3
              with:
                username: ${{ secrets.DOCKERUSERNAME }}
                password: ${{ secrets.DOCKERTOKEN }}

            # - name: Extract metadata (tags, labels) for Docker
            #   id: meta
            #   uses: docker/metadata-action@v5
            #   with:
            #     images: hingel/bookingrepo
            
            # Här ifrån...
            - name: Install dependencies
              run: dotnet restore
      
            - name: Build 
              run: dotnet build --configuration Release --no-restore

            - name: Build Docker image
              run: docker buildx build --platform linux/arm64/v8 . -t hingel/bookingrepo -f Dockerfile
            
            - name: Push image to hub
              run: docker push hingel/bookingrepo
            #... och hit är för test


            #- name: Build and push Docker image
            #   id: push
            #   uses: docker/build-push-action@v5
            #   with:
            #     context: .
            #     push: true
            #     tags: ${{ steps.meta.outputs.tags }}
            #     labels: ${{ steps.meta.outputs.labels }}
